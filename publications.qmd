---
title: "Publications"
---

```{r orchid-works, echo = FALSE, output = FALSE, warning = FALSE}

lab_member_details <- rbind(
  c("Andy Purvis", "0000-0002-8609-6204"),
  c("Adriana De Palma", "0000-0002-5345-4917"),
  c("Victoria J. Burton", "0000-0003-0122-3292"),
  c("Alexa Varah", "0000-0002-5024-0737"),
  c("Sophie Jane Tudge", "0000-0002-0447-9448"),
  c("Justin E. Isip", "0000-0002-9686-8888")
  # Sara?
  # Connor?
  # Patrick?
) |>
  as.data.frame() |>
  setNames(c("name", "orcid"))

# get all works from orcID using open alex
works_from_orcids <- openalexR::oa_fetch(
  entity = "works",
  author.orcid = lab_member_details$orcid,
  verbose = TRUE,
  output = "dataframe",
  abstract = FALSE
)

distinct_works <- works_from_orcids  |>
  # we don't actually have any retracted works in this list
  # but let's remove them just in case
  dplyr::filter(is_retracted == FALSE) |>
  # keep only the unique references
  dplyr::distinct(tolower(display_name), .keep_all = TRUE) |>
  # sort with the most recent publications first
  dplyr::arrange(dplyr::desc(publication_year))
```

```{r formatted-references, echo = FALSE, cache = TRUE}

# furnction to format OpenAlex outputs into a Harvard-style reference
GetFormattedReference <- function(reference, lab_member_details) {
  
  # extract the authors
  authors <- reference$authorships
  authors <- lapply(authors, function(x) {
    x$display_name
  })
  # transform into a vector
  authors <- unlist(authors)
  
  # embolden lab author
  authors[authors %in% lab_member_details$name] <- gluedown::md_bold(authors[authors %in% lab_member_details$name])
  
  # make a full author list for the reference
  if(length(authors) == 1) {
    author_list <- authors
  } else if (length(authors) == 2) {
    author_list <- paste0(authors, collapse = " & ")
  } else {
    author_list <- paste0(authors[1:length(authors) - 1], collapse = ", ") |>
      paste(" & ", authors[length(authors)])
  }
  
  # extract the doi or url
  if(!is.na(reference$doi)) {
    link <- gluedown::md_link(reference$doi, reference$doi)
  } else if (!is.na(reference$source_id)) {
    link <- gluedown::md_link(reference$source_id, reference$source_id)
  } else {
    link <- gluedown::md_link(reference$landing_page_url, reference$landing_page_url)
  }
  
  # transform the title to sentence case if needed
  title <- ifelse(
    reference$title == toupper(reference$title),
    stringr::str_to_sentence(reference$title),
    reference$title
  )

  # add the relevant information together
  formatted_ref <- paste0(
    author_list,
    " (", reference$publication_year, "). ",
    title, ", ",
    gluedown::md_italic(reference$source_display_name), ", ",
    link
  )
  
  # return the formatted reference
  return(formatted_ref)
}

# set up an empty vector to hold the results
distinct_references <- rep(NA, nrow(distinct_works))

# get the formatted reference for each open Alex entry
for(i in 1:length(distinct_references)) {
  distinct_references[i] <- GetFormattedReference(
    distinct_works[i, ],
    lab_member_details = lab_member_details
  )
}

```

The following is a list of publications from members of the lab. 



```{r render-references, output = "asis", echo = FALSE}
gluedown::md_paragraph(distinct_references)
```

